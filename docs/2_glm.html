<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Generalised Linear Models (GLMs)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computational Ecology</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="1_data_analysis.html">Data Analysis</a>
    </li>
    <li>
      <a href="2_glm.html">Generalised Linear Models</a>
    </li>
    <li>
      <a href="3_gam.html">Generalised Additive Models</a>
    </li>
    <li>
      <a href="4_sdm.html">Species Distribution Modelling</a>
    </li>
    <li>
      <a href="5_eDNA.html">Environmental DNA</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Generalised Linear Models (GLMs)</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In classical linear regression we make predictions of the <em>expected value</em> of a response variable as a function of the linear sum of covariates (also known as independent, explanatory or predictor variables). Generalised Linear Modelling (GLM) relaxes the constraint that ordinary linear regression has, in that the response variable must be normally distributed.</p>
<p>Why is the GLM useful for ecology problems? Often in ecology the response variable is in the form of counts or a presence v absence, and in general the response variable exhibits a mean-variance relationship that is not normally distributed.</p>
<div id="three-key-properties-of-the-glm" class="section level2">
<h2>Three key properties of the GLM</h2>
<ol style="list-style-type: decimal">
<li>In a GLM it is assumed that the response variable (and residual errors) is from a distribution in the exponential family. These response variable distributions and their relevance comprise:</li>
</ol>
<ul>
<li><em>Negative binomial</em> regression - non-negative count data, but variance can vary independently of the mean to handle <em>overdispersion</em></li>
<li><em>Poisson</em> regression - non-negative count data. Here the mean equals the variance. A sub-class of the negative binomial</li>
<li><em>Gamma</em> regression - positive continuous data</li>
<li><em>Binomial</em> (or logistic) regression - binary or proportional data</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p>The response variable is a linear sum of the predictor variables</p></li>
<li><p>There is a linear relationship between a function g (the <em>link function</em> ) of the mean of the response variable, and the predictor variables. This function is used to transform the non-linear relationship to a linear one. There are a number of different link functions for each response variable distribution.</p></li>
</ol>
<p>More detail on the mathematical basis for the GLM, and associated link functions, can be found here<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
</div>
<div id="the-doubs-dataset" class="section level2">
<h2>The Doubs dataset</h2>
<p>As in the Data Analysis vignette (link) we will be using the doubs<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> dataset to undertake a GLM exercise. Here the response is count data for river fish species across 30 sites, so is likely to be a <code>Poisson</code> distribution. The covariates are a number of measurements of water chemistry and physical characteristics at each of the 30 sites.</p>
<pre class="r"><code>#Let&#39;s load the data
data(doubs)

# Set-up species data
species &lt;- doubs$fish

# Set-up environmental data
environ &lt;- doubs$env</code></pre>
<p>We can get a quick overview of the response data (species counts at each of the 30 site) set using the <code>skimr</code> library:</p>
<pre class="r"><code># Look at the data - drop the site column
skim(species)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">species</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">30</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">27</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">27</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Cogo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.50</td>
<td align="right">0.94</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.75</td>
<td align="right">3</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Satr</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.90</td>
<td align="right">2.04</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">3.75</td>
<td align="right">5</td>
<td align="left">▇▁▂▁▃</td>
</tr>
<tr class="odd">
<td align="left">Phph</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.27</td>
<td align="right">1.98</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3.0</td>
<td align="right">4.00</td>
<td align="right">5</td>
<td align="left">▇▁▂▅▂</td>
</tr>
<tr class="even">
<td align="left">Neba</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.43</td>
<td align="right">1.92</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.0</td>
<td align="right">4.00</td>
<td align="right">5</td>
<td align="left">▇▂▂▂▅</td>
</tr>
<tr class="odd">
<td align="left">Thth</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.50</td>
<td align="right">1.01</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.75</td>
<td align="right">4</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Teso</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.63</td>
<td align="right">1.30</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.75</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Chna</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.60</td>
<td align="right">0.86</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="left">▇▃▁▂▁</td>
</tr>
<tr class="even">
<td align="left">Chto</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.87</td>
<td align="right">1.31</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">2.00</td>
<td align="right">4</td>
<td align="left">▇▁▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">Lele</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.43</td>
<td align="right">1.50</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">2.00</td>
<td align="right">5</td>
<td align="left">▇▃▂▁▁</td>
</tr>
<tr class="even">
<td align="left">Lece</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.87</td>
<td align="right">1.36</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.0</td>
<td align="right">3.00</td>
<td align="right">5</td>
<td align="left">▇▅▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">Baba</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.43</td>
<td align="right">1.76</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">3.00</td>
<td align="right">5</td>
<td align="left">▇▂▂▂▁</td>
</tr>
<tr class="even">
<td align="left">Spbi</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.90</td>
<td align="right">1.40</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Gogo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.83</td>
<td align="right">1.84</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">3.75</td>
<td align="right">5</td>
<td align="left">▇▂▁▂▂</td>
</tr>
<tr class="even">
<td align="left">Eslu</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.33</td>
<td align="right">1.52</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">2.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Pefl</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.20</td>
<td align="right">1.54</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.5</td>
<td align="right">2.00</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Rham</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.10</td>
<td align="right">1.65</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">2.00</td>
<td align="right">5</td>
<td align="left">▇▁▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">Legi</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.97</td>
<td align="right">1.40</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.75</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Scer</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.70</td>
<td align="right">1.15</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Cyca</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.83</td>
<td align="right">1.34</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Titi</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.50</td>
<td align="right">1.74</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">3.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▂▁</td>
</tr>
<tr class="odd">
<td align="left">Abbr</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.87</td>
<td align="right">1.53</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Icme</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.60</td>
<td align="right">1.30</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">Acce</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.27</td>
<td align="right">1.89</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">2.00</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td align="left">Ruru</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.10</td>
<td align="right">2.20</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1.0</td>
<td align="right">5.00</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▅</td>
</tr>
<tr class="odd">
<td align="left">Blbj</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.03</td>
<td align="right">1.71</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.75</td>
<td align="right">5</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">Alal</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.90</td>
<td align="right">2.25</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">5.00</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▅</td>
</tr>
<tr class="odd">
<td align="left">Anan</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0.90</td>
<td align="right">1.45</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0</td>
<td align="right">1.75</td>
<td align="right">5</td>
<td align="left">▇▂▁▁▁</td>
</tr>
</tbody>
</table>
<p>We can see that there are 27 species, with no missing data. Some are more numerous than others, but it doesn’t seem like the data are overdisperesed. It’s clear from the simplified histrogram column that species counts are not nomrally distributed, and that a <em>Poisson</em> distribution would be a good fit for response variable data.</p>
<p>Similarly the covariate dataset:</p>
<pre class="r"><code># Look at the data - drop the site column
skim(environ)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">environ</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">30</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">11</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dfs</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1879.03</td>
<td align="right">1396.51</td>
<td align="right">3.0</td>
<td align="right">544.50</td>
<td align="right">1752.00</td>
<td align="right">3017.25</td>
<td align="right">4530.00</td>
<td align="left">▇▅▅▅▃</td>
</tr>
<tr class="even">
<td align="left">alt</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">481.50</td>
<td align="right">271.39</td>
<td align="right">172.0</td>
<td align="right">248.00</td>
<td align="right">395.00</td>
<td align="right">782.00</td>
<td align="right">934.00</td>
<td align="left">▇▃▂▁▅</td>
</tr>
<tr class="odd">
<td align="left">slo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.76</td>
<td align="right">1.08</td>
<td align="right">1.1</td>
<td align="right">1.83</td>
<td align="right">2.56</td>
<td align="right">3.39</td>
<td align="right">6.18</td>
<td align="left">▆▇▅▂▁</td>
</tr>
<tr class="even">
<td align="left">flo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2220.10</td>
<td align="right">1810.19</td>
<td align="right">84.0</td>
<td align="right">420.00</td>
<td align="right">2210.00</td>
<td align="right">2857.50</td>
<td align="right">6900.00</td>
<td align="left">▇▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="left">pH</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">80.50</td>
<td align="right">1.74</td>
<td align="right">77.0</td>
<td align="right">79.25</td>
<td align="right">80.00</td>
<td align="right">81.00</td>
<td align="right">86.00</td>
<td align="left">▁▇▆▂▁</td>
</tr>
<tr class="even">
<td align="left">har</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">86.10</td>
<td align="right">16.87</td>
<td align="right">40.0</td>
<td align="right">84.25</td>
<td align="right">89.00</td>
<td align="right">96.75</td>
<td align="right">110.00</td>
<td align="left">▂▁▁▇▃</td>
</tr>
<tr class="odd">
<td align="left">pho</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">55.77</td>
<td align="right">87.64</td>
<td align="right">1.0</td>
<td align="right">12.50</td>
<td align="right">28.50</td>
<td align="right">56.00</td>
<td align="right">422.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">nit</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">165.40</td>
<td align="right">141.34</td>
<td align="right">15.0</td>
<td align="right">50.50</td>
<td align="right">160.00</td>
<td align="right">242.50</td>
<td align="right">620.00</td>
<td align="left">▇▆▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">amm</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">20.93</td>
<td align="right">37.91</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
<td align="right">10.00</td>
<td align="right">20.00</td>
<td align="right">180.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">oxy</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">93.90</td>
<td align="right">22.15</td>
<td align="right">41.0</td>
<td align="right">80.25</td>
<td align="right">102.00</td>
<td align="right">109.00</td>
<td align="right">124.00</td>
<td align="left">▂▃▃▇▆</td>
</tr>
<tr class="odd">
<td align="left">bdo</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">51.17</td>
<td align="right">38.64</td>
<td align="right">13.0</td>
<td align="right">27.25</td>
<td align="right">41.50</td>
<td align="right">52.75</td>
<td align="right">167.00</td>
<td align="left">▇▃▁▁▁</td>
</tr>
</tbody>
</table>
<p>We can see that there are no missing data. We can visualise the response data against the covariates using the <code>featurePlot</code> function from the <code>caret</code> library.</p>
<pre class="r"><code>featurePlot(x=environ, y= species$Ruru)</code></pre>
<p><img src="2_glm_files/figure-html/feature_plot-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>With this simple chart we can see how the count for <em>Ruru</em> species is at a maximum for relatively low concentrations for ammonium and phosphate and high values for chalkiness (covariate <code>har</code>) of the river water.</p>
<p>Given the response and covariate datasets we can fit a GLM with the doubs data. We fit the count data for the species <em>Ruru</em> against all environmental covaraites, usung a Poisson distribution. A response variable that is Poisson distributed usually uses a log link function. Note, we know from the Data Analysis vignette (link) that some covariates within the <code>eviron</code> dataset have significant collinearity, so the model results may not be ideal.</p>
<pre class="r"><code># Fit GLM to species Ruru - use all environmental covariates to fit the model
ruru_model &lt;- glm(formula = species$Ruru ~ . ,  
                     # Use a Poisson distribution for the response variable
                     family= poisson(link = &quot;log&quot;), 
                     data = environ)

# Summarise the model fit
summary(ruru_model)</code></pre>
<pre><code>## 
## Call:
## glm(formula = species$Ruru ~ ., family = poisson(link = &quot;log&quot;), 
##     data = environ)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.57253  -0.88709  -0.34156   0.08549   2.79357  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  2.119e+01  8.809e+00   2.405   0.0162 *
## dfs         -4.277e-04  1.537e-03  -0.278   0.7809  
## alt         -3.473e-03  4.513e-03  -0.770   0.4415  
## slo         -4.544e-01  3.546e-01  -1.281   0.2000  
## flo          7.666e-05  6.587e-04   0.116   0.9074  
## pH          -1.001e-01  1.297e-01  -0.772   0.4400  
## har         -9.824e-03  2.253e-02  -0.436   0.6627  
## pho         -8.443e-03  7.057e-03  -1.196   0.2316  
## nit         -3.028e-04  4.054e-03  -0.075   0.9405  
## amm          1.575e-02  1.903e-02   0.828   0.4079  
## oxy         -7.058e-02  3.580e-02  -1.971   0.0487 *
## bdo         -3.361e-02  1.867e-02  -1.800   0.0718 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 81.864  on 29  degrees of freedom
## Residual deviance: 31.361  on 18  degrees of freedom
## AIC: 109.06
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>To understand which covariates have an effect on the response variable, we will look at the p values associated with each covariate in the table above. We can see that the <code>oxy</code> covariate is significant for the Ruru counts. If the p-value &lt; 0.05 then, the covariate has a significant effect on the response variable.</p>
<p>We can also check to see if the model fit is over or under-dispersed by looking at the <em>residual deviance</em>. If the residual deviance is substantially greater than the degrees of freedom, then the model is over-dispersed; the predicted values are correct but the standard deviation are not accounted for by the model. In the model fit above the residual deviance is close to the degrees of freedom, and the dispersion parameter is 31.361/18 = 1.74 (which is small), so the model is a good fit.</p>
<p>The <em>null deviance</em> shows the predicted response when only the intercept (the overall mean) is included in the data. We can see that adding the covariates into the model reduces the null-deviance by around 50. Again, a good sign in terms of the model’s overall suitability.</p>
</div>
</div>
<div id="a-general-protocol-for-predictive-modelling" class="section level1">
<h1>A general protocol for predictive modelling</h1>
<p>A general protcol for how to proceed with predictive modelling, for both statistical regression and machine learning techinuqes, is presented below. When fitting a covariates to a model of response data, there are four key steps. In this vignette we will focus on the GLM, but the approach is equally valid for other modelling methods too. The four steps are:</p>
<ol style="list-style-type: decimal">
<li>Split the available data into training and modelling data sets.</li>
<li>Choose a modelling method and fit the model -</li>
<li>Use the model fit to make predictions</li>
<li>Calculate the accuracy of the model preictions using relevant metrics on the test data.</li>
</ol>
<div id="caret" class="section level2">
<h2>Caret</h2>
<p>We are going to use the <code>caret</code> package for running model fitting. The package is highly flexible and be used for all Let us look at the relationship between each predictor variable and the response. First we split our data into train and test subsets. Each subset will be further split later on using a method known as k-fold cross validation. This involves splitting a dataset into k-subsets. Each subset is held out while the model is trained on all other subsets. This process is completed until accuracy is determined for each instance in the dataset, and an overall accuracy estimate is provided.</p>
<pre class="r"><code>inTrain &lt;- createDataPartition(y = species$Ruru, p = 0.6, list = FALSE)
training &lt;- cbind(environ[inTrain,], y = species$Ruru[inTrain])
testing &lt;-  cbind(environ[-inTrain,], y = species$Ruru[-inTrain])</code></pre>
<p>Firstly we can use <code>caret</code> to help in identifying which features are the most significant in fitting a glm. We do this with <em>recursive feature elimination</em> as follows:</p>
<pre class="r"><code># Set seed for repeatable randomisation
set.seed(123)

# Specify the control parameters for the RFE
rfe_ctrl &lt;- rfeControl(
  # Use a random forest algorithm to to evaluate feature selection
  functions = lmFuncs, 
  # Use 3-fold cross validation 
  method = &quot;cv&quot;,
  number = 3,
  returnResamp = &quot;final&quot;,
  verbose = F)

# Perform RFE
rfe &lt;- rfe(
  x = within(training, rm(y)), 
  y = training$y,
  # Limit the covariates to no more than 5
  sizes= c(1, 3, 5, 8, 11), 
  rfeControl = rfe_ctrl)

# Let&#39;s look at the results
rfe</code></pre>
<pre><code>## 
## Recursive feature selection
## 
## Outer resampling method: Cross-Validated (3 fold) 
## 
## Resampling performance over subset size:
## 
##  Variables  RMSE Rsquared   MAE RMSESD RsquaredSD  MAESD Selected
##          1 2.026  0.27340 1.839 0.3155    0.29146 0.1168        *
##          3 2.586  0.13398 2.092 0.4715    0.20683 0.2417         
##          5 5.197  0.02429 3.601 3.5952    0.02009 1.9613         
##          8 3.227  0.04984 2.693 0.5648    0.07002 0.5175         
##         11 9.305  0.16458 7.519 3.0318    0.14307 1.4946         
## 
## The top 1 variables (out of 1):
##    slo</code></pre>
<p>We see that the model with four variables resulted in the lowest root means squared error (RMSE). So now we can proceed to fitting a GLM using the optimum features (covariates).</p>
<pre class="r"><code># Create the formula for the glm
y &lt;- &quot;y&quot;
xs  &lt;- rfe$optVariables
form &lt;- as.formula(paste(y, paste(xs, collapse = &quot; + &quot;), sep=&quot; ~ &quot;))

set.seed(1895)

glm_fit &lt;- train(
  # Use the formula given the best features from the rfe process
  form, 
  # Select data to train the model on
  data = training,
  # Select the glm method with the poisson distribution
  method = &quot;glm&quot;, family = &quot;poisson&quot;,
  # Cross validation 5-fold, repeated 5 times
  trControl = trainControl(
    method = &quot;repeatedcv&quot;, 
    number = 5,
    repeats = 5))

# What are the important of the covariates in them model?
varImp(glm_fit) %&gt;% plot()</code></pre>
<pre><code>## Warning in FUN(newX[, i], ...): no non-missing arguments to max; returning
## -Inf</code></pre>
<p><img src="2_glm_files/figure-html/caret_search-1.png" width="672" /></p>
<pre class="r"><code># Show model fit and covariate significance
summary(glm_fit)</code></pre>
<pre><code>## 
## Call:
## NULL
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.5367  -1.5685  -0.4848   1.1401   2.2965  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   2.1983     0.5578   3.941 8.11e-05 ***
## slo          -0.5746     0.2251  -2.553   0.0107 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 48.643  on 18  degrees of freedom
## Residual deviance: 41.581  on 17  degrees of freedom
## AIC: 80.743
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<pre class="r"><code>glm_fit</code></pre>
<pre><code>## Generalized Linear Model 
## 
## 19 samples
##  1 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold, repeated 5 times) 
## Summary of sample sizes: 15, 15, 15, 16, 15, 15, ... 
## Resampling results:
## 
##   RMSE      Rsquared   MAE     
##   2.249549  0.3782938  1.974566</code></pre>
<pre class="r"><code># how accurate was the trained model on the test data set?
# Make a prediction on the test data set
pred &lt;- predict(glm_fit, newdata = testing)

pred</code></pre>
<pre><code>##         1         3         7        11        14        17        19 
## 0.2591203 1.1139252 0.8041960 1.0517225 2.0635824 3.2175328 3.2175328 
##        23        27        28        30 
## 2.0635824 2.0635824 4.0629340 4.7913759</code></pre>
<pre class="r"><code># Calculate prediction accuracy of model, given test data</code></pre>
<p>As we know from the vignette on Data Exploration, there is significant colinearity between a specific group of covariates. Hence <code>alt</code> and <code>dfs</code> are collinear. We can see this from the covariate significance in the above results.</p>
<p>The caret led process has generated a model that has slightly higher residual deviance than the initial model that included all covariates. But the caret model only has one covariate, as selected by the RFE. This is reflected in the AIC score and means that a much simpler model gives effectively the same results, in terms of residual errors.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Generalised Linear Modelling - <a href="https://en.wikipedia.org/wiki/Generalized_linear_model" class="uri">https://en.wikipedia.org/wiki/Generalized_linear_model</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Verneaux, J. (1973) Cours d’eau de Franche-Comté (Massif du Jura). Recherches écologiques sur le réseau hydrographique du Doubs. Essai de biotypologie. Thèse d’état, Besançon. 1–257. <em>Doubs river fish communities</em>. <a href="https://www.davidzeleny.net/anadat-r/doku.php/en:data:doubs" class="uri">https://www.davidzeleny.net/anadat-r/doku.php/en:data:doubs</a><a href="#fnref2">↩</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
